<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bugchain</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="css/common.css">


    <!-- Latest compiled and minified JavaScript -->

    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <link type="text/css" rel="stylesheet" href="bower_components/jsgrid/dist/jsgrid.min.css"/>
    <link type="text/css" rel="stylesheet" href="bower_components/jsgrid/dist/jsgrid-theme.min.css"/>

    <script type="text/javascript" src="bower_components/jsgrid/dist/jsgrid.min.js"></script>
    <script type="text/javascript" src="javascript/common.js"></script>


</head>
<body>

<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header" id="bar">
            <a class="navbar-brand" href="index.html">
                <img alt="Bugchain" src="resources/0_Logo.png">
            </a>


        </div>
    </div>
</nav>

<div class="container col-lg-10">
    <h1>Личный кабинет</h1>
    <div class="row">
        <div class="col-lg-12">
            <div class="row">
                <label for="clientName" class="col-sm-5 control-label">Название/Имя</label>
                <div class="col-sm-7">
                    <p id="clientName"></p>
                </div>
            </div>
            <div class="row">
                <label for="inputEmail" class="col-sm-5 control-label">Адрес электронной почты</label>
                <div class="col-sm-7">
                    <p id="inputEmail"></p>
                </div>
            </div>
            <div class="row">
                <label for="clientDescription" class="col-sm-5 control-label">Описание</label>
                <div class="col-sm-7">
                    <p id="clientDescription" rows="3"></p>
                </div>
            </div>
            <button id='addTaskButton' class="btn btn-success btn-lg">Добавить задание</button>

        </div>
    </div>
    <h2>Опубликованные задания</h2>
    <div id="jsGrid" class="col-lg-12"></div>

</div>


<script>
    var tasks = [];

    setLogOut($('#bar'));

    let email = getCookie('email');

    $.ajax({
        url: '/api/find?email=' + email,
        type: 'GET',
        statusCode: {
            200: function (result) {
                document.getElementById('clientName').innerHTML = result.name;
                document.getElementById('inputEmail').innerHTML = result.email;
                document.getElementById('clientDescription').innerHTML = result.description;
                tasks = result.tasks;
                if ((tasks) && (tasks.length > 0)) {
                    for (let task of tasks) {
                        let to = new Date(task.timeTo.year, task.timeTo.monthValue - 1, task.timeTo.dayOfMonth);
                        let from = new Date(task.timeFrom.year, task.timeFrom.monthValue - 1, task.timeFrom.dayOfMonth);
                        let timeDiff = Math.abs(to.getTime() - from.getTime());
                        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));
                        task.timeRest = diffDays;

                    }
                }
            }
        }
    });

    document.getElementById('addTaskButton').onclick = function () {
        window.location.href = ("client_add_new_task.html");
    };


    $(function () {

//        var MyDateField = function (config) {
//            jsGrid.Field.call(this, config);
//        };
//
//        MyDateField.prototype = new jsGrid.Field({
//            sorter: function (date1, date2) {
//                return new Date(date1) - new Date(date2);
//            },
//
//            itemTemplate: function (value) {
//                return new Date(value).toDateString();
//            },
//
//            insertTemplate: function (value) {
//                return this._insertPicker = $("<input>").datepicker({defaultDate: new Date()});
//            },
//
//            editTemplate: function (value) {
//                return this._editPicker = $("<input>").datepicker().datepicker("setDate", new Date(value));
//            },
//
//            insertValue: function () {
//                return this._insertPicker.datepicker("getDate").toISOString();
//            },
//
//            editValue: function () {
//                return this._editPicker.datepicker("getDate").toISOString();
//            }
//        });
//
//        jsGrid.fields.myDateField = MyDateField;

        $("#jsGrid").jsGrid({
            height: "90%",
            width: "100%",

            sorting: true,
            editing: false,

            data: tasks,

            fields: [
                {name: "name", title: "Название", type: "text", width: 100},
                {name: "count", title: "Максимальное количество победителей", type: "number", width: 100},
                {name: "price", title: "Сумма контракта(ETH)", type: "number", width: 100},
//                {name: "TimeTo", title: "Осталось до завершения задания", type: "text", width: 150},
//                {name: "maxRate", title: "Максимальная ставка", type: "number", width: 100},
                {name: "timeRest", title: "Осталось до завершения торгов", type: "text", width: 150},
                {name: "successes", title: "Успешно", type: "number", width: 100},
                {name: "tries", title: "Попыток", type: "number", width: 100}
            ]
        });

    });


</script>

</body>
</html>
