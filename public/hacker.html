<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bugchain</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/hacker.css">
    <link rel="stylesheet" href="css/common.css">


    <!-- Latest compiled and minified JavaScript -->

    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <link type="text/css" rel="stylesheet" href="bower_components/jsgrid/dist/jsgrid.min.css"/>
    <link type="text/css" rel="stylesheet" href="bower_components/jsgrid/dist/jsgrid-theme.min.css"/>

    <script type="text/javascript" src="bower_components/jsgrid/dist/jsgrid.min.js"></script>
    <script type="text/javascript" src="javascript/common.js"></script>


</head>
<body>

<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header" id="bar">
            <a class="navbar-brand" href="index.html">
                <img alt="Bugchain" src="resources/0_Logo.png">
            </a>


        </div>
    </div>
</nav>

<div class="container col-lg-10">

    <h1>Список заданий</h1>
    <div id="jsGrid" class="col-lg-12"></div>

</div>


<script>

    setCookie('task', '');

    var tasks = [];

    $.ajax({
        url: '/api/tasks',
        type: 'GET',
        statusCode: {
            200: function (result) {
                tasks = result;
                if ((tasks) && (tasks.length > 0)) {
                    for (let task of tasks) {
                        let to = new Date(task.timeTo.year, task.timeTo.monthValue - 1, task.timeTo.dayOfMonth);
                        let from = new Date(task.timeFrom.year, task.timeFrom.monthValue - 1, task.timeFrom.dayOfMonth);
                        let timeDiff = Math.abs(to.getTime() - from.getTime());
                        task.timeRest = Math.ceil(timeDiff / (1000 * 3600 * 24));
                    }
                }
//                console.log(JSON.stringify(tasks));
                $(function () {

                    $("#jsGrid").jsGrid({
                        height: "90%",
                        width: "100%",

                        sorting: true,
                        editing: false,
                        autoload: false,
                        paging: false,


                        data: tasks,

                        fields: [
                            {name: "name", title: "Название", type: "text", width: 100},
                            {name: "count", title: "Максимальное количество победителей", type: "number", width: 100},
                            {name: "price", title: "Сумма контракта(ETH)", type: "number", width: 100},
                            {name: "timeRest", title: "Осталось дней до завершения задания", type: "text", width: 150},
                            {
                                type: "control",
                                deleteButton: false,
                                editButton: false,
                                itemTemplate: function (value, item) {
                                    var $result = jsGrid.fields.control.prototype.itemTemplate.apply(this, arguments);
                                    var $customButton = acceptTask(item);

                                    return $result.add($customButton);
                                }

                            }
                        ],

                    });

                });

            }
        }
    });

    function acceptTask(item) {
        return $("<button>")
            .text("Принять")
            .click(function (e) {
                setCookie('task', item.id);
                window.location.href = 'task.html';
            });
    }


</script>

</body>
</html>
